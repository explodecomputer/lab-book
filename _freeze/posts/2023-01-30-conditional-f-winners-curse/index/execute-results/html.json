{
  "hash": "2434e32a36794a8582ada99653639ee7",
  "result": {
    "markdown": "---\ntitle: \"Can winner's curse generate a high conditional F statistic\"\nauthor: Gibran Hemani\ndate: \"2023-01-30\"\ncategories: [statistics, winner's curse, multivariable mr]\nexecute: \n    output: false\n---\n\n\n## Background\n\nMultivariable MR requires that exposure effects are heterogeneous, indicated by the conditional F-statistic. If the sample overlap between two exposures is 0, how much can winner's curse drive apparent heterogeneity?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(simulateGP)\nlibrary(dplyr)\nlibrary(MVMR)\nlibrary(ggplot2)\n\n# 1. Simulate architecture for nsnps\n# 2. Simualate two independent GWAS summary datasets each with sample size nid\n# 3. Identify instruments significant in each dataset\n# 4. Calculate conditional Fstat for these independent instruments\n# 5. Repeat for a random selection of instruments (no selection)\nsim <- function(nsnp, nid)\n{\n    map <- tibble(snp=1:nsnp, af=runif(nsnp, 0.01, 0.99)) %>%\n        generate_gwas_params(h2=0.4, S=-0.1, Pi=1)\n    map\n\n    ss1 <- generate_gwas_ss(map, nid)\n    ss2 <- generate_gwas_ss(map, nid)\n\n    table(ss1$pval < 5e-8, ss2$pval < 5e-8)\n\n    inst1 <- subset(ss1, pval < 5e-8)$snp\n    inst2 <- subset(ss2, pval < 5e-8)$snp\n    insts <- unique(c(inst1, inst2))\n\n    mvmrdat <- format_mvmr(\n        BXGs = cbind(ss1$bhat[insts], ss2$bhat[insts]), \n        BYG = runif(length(insts)), \n        seBXGs = cbind(ss1$se[insts], ss2$se[insts]),\n        seBYG = rep(0.1, length(insts)),\n        RSID = insts\n    )\n    selected <- strength_mvmr(mvmrdat, 0)\n\n    insts_random <- sample(map$snp, length(insts), replace=FALSE)\n    mvmrdat_random <- format_mvmr(\n        BXGs = cbind(ss1$bhat[insts_random], ss2$bhat[insts_random]), \n        BYG = runif(length(insts_random)), \n        seBXGs = cbind(ss1$se[insts_random], ss2$se[insts_random]),\n        seBYG = rep(0.1, length(insts_random)),\n        RSID = insts\n    )    \n    random <- strength_mvmr(mvmrdat_random, 0)\n    return(list(selected=selected, random=random, ninst=length(insts)))\n}\n\n# Simulation parameters\nparam <- expand.grid(\n    nsnp=seq(5000, 100000, by=5000), \n    nid=240000,\n    nsim=1:5\n)\n\n# Run simulations\no <- lapply(1:nrow(param), function(i)\n{\n    x <- param[i,]\n    o <- sim(x$nsnp, x$nid)\n    bind_cols(\n        x, \n        tibble(\n            what=c(\"selected\", \"random\"), \n            Fstat=c(o$selected$exposure1[1], o$random$exposure1[1]), \n            ninst=o$ninst\n        )\n    )\n}) %>% bind_rows()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot\nggplot(o, aes(x=as.factor(nsnp), y=Fstat)) +\ngeom_boxplot(aes(fill=what)) +\nlabs(x=\"Number of causal variants\", y=\"Conditional F-statistic\", fill=\"\") +\ntheme(axis.text.x=element_text(angle=90))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nSo, it looks like winner's curse alone can generate quite large conditional F stat ~4 under some circumstances - that the number of causal variants is very high like 60k with n=240000 in each GWAS (which essentially means that most of the GWAS hits are hovering around the significance threshold, which is where winner's curse is maximised). The empirical analysis in ukbb will be useful to get a more concrete answer on how much it's realistically contributing\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}