{
  "hash": "ee52889748d8e36d3f3524b7c1e87a5d",
  "result": {
    "markdown": "---\ntitle: \"Rsq in simulations\"\nauthor: Gibran Hemani\ndate: \"2023-12-06\"\ncategories: []\n---\n\n\n## Background\n\nWhat determines $R^2$ between X and Y in a linear model under confounding\n\n$$\n\\begin{aligned}\n\nY &= a + bX + E \\\\\nb &= cov(X, Y) / var(X) \\\\\nR &= cov(X, Y) / [sd(X)sd(Y)] \\\\\n&= b * sd(x) / sd(y)\n\n\\end{aligned}\n$$\n\nIn OLS the b will be different to the IV b if there is unmeasured confounding\n\n$$\n\\begin{aligned}\nX &= a + \\beta_1 G + \\beta_2 U + \\epsilon \\\\\nY &= a + b_1 X + b_2 U + E \\\\\n\nb_{OLS} &= cov(X, Y) / var(X) \\\\\n&= cov(\\beta_1 G + \\beta_2 U, b_1(\\beta_1 G + \\beta_2 U) + b_2 U)/var(X) \\\\\n&= cov(\\beta_1 G + \\beta_2 U, b_1\\beta_1 G + b_1\\beta_2 U + b_2 U)/var(X) \\\\\n&= [b_1\\beta_1^2 var(G) + (b_1\\beta_2^2 + b_2\\beta_2) var(U)]/var(X) \\\\\n\n\n\\end{aligned}\n$$\n\nand\n\n$$\nR_{OLS} = b_{OLS} sd(x)/sd(y)\n$$\n\ntherefore to get the OLS $R^2$ of X,Y\n\n$$\nR^2 = \\left [ \\frac{b_1\\beta_1^2 var(G) + (b_1\\beta_2^2 + b_2\\beta_2) var(U)}{sd(x) sd(y)} \\right]^2\n$$\n\nNote that \n\n$$\n\\begin{aligned}\nvar(x) &= sd(x)^2 = \\beta_1^2var(G) + \\beta_2^2var(U) + var(\\epsilon) \\\\\nvar(y) &= sd(y)^2 = b_1^2var(X) + b_2^2var(U) + var(E) \\\\\n\\end{aligned}\n$$\n\nSo ultimately if you want to fix $R^2$ for different parameters of effects you should be able to scale $var(\\epsilon)$ and $var(E)$, the residual variances, according to these formulae. \n\nBy contrast the variance explained by the causal effect of X is\n\n$$\nR^2_{IV, x,y} = b^2_1var(X) / var(Y)\n$$\n\n\n## Check\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1)\nb1 <- 0.2\nb2 <- 3\nbeta1 <- 4\nbeta2 <- 5\nn <- 10000\nu <- rnorm(n)\ng <- rnorm(n)\nx <- u * beta2 + g * beta1 + rnorm(n)\ny <- u * b2 + x * b1 + rnorm(n, sd=0)\n```\n:::\n\n\nBeta\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncov(x, y)/var(x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.562716\n```\n:::\n\n```{.r .cell-code}\nsummary(lm(y ~ x))$coef[2,1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.562716\n```\n:::\n\n```{.r .cell-code}\n( b1*beta1^2*var(g) + (b1*beta2^2 + b2*beta2) * var(u) ) / var(x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.5557103\n```\n:::\n:::\n\n\nCorrelation\n\n\n::: {.cell}\n\n```{.r .cell-code}\n((( b1*beta1^2*var(g) + (b1*beta2^2 + b2*beta2) * var(u) ) / var(x)) * sd(x) / sd(y))^2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.768337\n```\n:::\n\n```{.r .cell-code}\ncor(x, y)^2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.7878316\n```\n:::\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.2 (2023-10-31)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.6\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.3 compiler_4.3.2    fastmap_1.1.1     cli_3.6.1        \n [5] tools_4.3.2       htmltools_0.5.7   yaml_2.3.7        rmarkdown_2.25   \n [9] knitr_1.45        jsonlite_1.8.7    xfun_0.41         digest_0.6.33    \n[13] rlang_1.1.2       evaluate_0.23    \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}