{
  "hash": "9a2fa5ba31a4105cc79f01d1fd6d446b",
  "result": {
    "markdown": "---\ntitle: \"Checking PCA projection\"\nauthor: Gibran Hemani\ndate: \"2023-06-06\"\ncategories: [Statistics]\n---\n\n\n## Background\n\nNeed to be able to calculate genetic principal components in unrelateds and then project into relateds.\n\nSimulate\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\nm <- 20\nA <- matrix(runif(m^2)*2-1, ncol=m)\nsigma <- t(A) %*% A\ngen <- mvrnorm(1000, rep(0, m), sigma)\n```\n:::\n\n\nGenerate in full sample\n\n\n::: {.cell}\n\n```{.r .cell-code}\npcafull <- princomp(gen)\nnames(pcafull)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"sdev\"     \"loadings\" \"center\"   \"scale\"    \"n.obs\"    \"scores\"   \"call\"    \n```\n:::\n:::\n\n\n\nGenerate in 90%\n\n\n::: {.cell}\n\n```{.r .cell-code}\npca90 <- princomp(gen[1:900,])\n```\n:::\n\n\nProject into remaining 10%\n\n\n::: {.cell}\n\n```{.r .cell-code}\npca10 <- gen[901:1000,] %*% pca90$loadings\n```\n:::\n\n\ncorrelate full with projected\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiag(cor(pca10, pcafull$scores[901:1000,]))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Comp.1    Comp.2    Comp.3    Comp.4    Comp.5    Comp.6    Comp.7    Comp.8 \n0.9979686 0.9869467 0.9829454 0.9843170 0.9927274 0.9905525 0.9942163 0.9960611 \n   Comp.9   Comp.10   Comp.11   Comp.12   Comp.13   Comp.14   Comp.15   Comp.16 \n0.9994964 0.9965984 0.9981390 0.9818166 0.9838703 0.9984871 0.9972718 0.9968159 \n  Comp.17   Comp.18   Comp.19   Comp.20 \n0.9982290 0.9993551 0.9991197 0.9989832 \n```\n:::\n:::\n\n\nThis works fine. Looks like GCTA does something similar here: https://yanglab.westlake.edu.cn/software/gcta/#PCloadingandprojection\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.0 (2023-04-21)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Monterey 12.6.2\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] MASS_7.3-58.4\n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.2 compiler_4.3.0    fastmap_1.1.1     cli_3.6.1        \n [5] tools_4.3.0       htmltools_0.5.5   rstudioapi_0.14   yaml_2.3.7       \n [9] rmarkdown_2.22    knitr_1.43        xfun_0.39         digest_0.6.31    \n[13] jsonlite_1.8.4    rlang_1.1.1       evaluate_0.21    \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}