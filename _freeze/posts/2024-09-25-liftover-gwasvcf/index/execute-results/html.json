{
  "hash": "f67c26db8a7fc8b8d6d21063b27e2c89",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Liftover gwasvcf\"\nauthor: Gibran Hemani\ndate: \"2024-09-25\"\ncategories: []\n---\n\n\n## Background\n\nNeed an efficient way to liftover gwas-vcf files from hg19 to hg38. First tried picard:\n\n```bash\n~/bin/java/jdk-23/bin/java -jar ~/bin/picard.jar CreateSequenceDictionary -R hg38.fa.gz -O hg38.dict\n\njava -jar picard.jar \n      R=reference.fasta \\ \n      O=reference.dict\n\n~/bin/java/jdk-23/bin/java -jar ~/bin/picard.jar LiftoverVcf \\\n     -I ieu-a-2.vcf.gz \\\n     -O lifted_over.vcf \\\n     -CHAIN hg19ToHg38.over.chain.gz \\\n     -REJECT rejected_variants.vcf \\\n     -R hg38.fa.gz\n```\n\nThis left no lifted variants - probably because the chromosome names weren't matching. bcftools +liftover option seems to be much more reliable\n\n```bash\n# Install bcftools http://samtools.github.io/bcftools/howtos/install.html\n# Download plugin binaries https://software.broadinstitute.org/software/score/\nexport BCFTOOLS_PLUGINS=/path/to/bcftools-plugins && bcftools +liftover\n# Download hg19.fa\nwget https://genvisis.umn.edu/rsrc/Genome/hg19/hg19.fa\n# Download hg38.fa\nwget https://genvisis.umn.edu/rsrc/Genome/hg38/hg38.fa\n# Download chain file\nwget https://hgdownload.soe.ucsc.edu/gbdb/hg19/liftOver/hg19ToHg38.over.chain.gz\n\n# Example gwas-vcf file\nwget https://gwas.mrcieu.ac.uk/files/ieu-a-2/ieu-a-2.vcf.gz\n\n# Example liftover\nbcftools +liftover --no-version -Ou ieu-a-2.vcf.gz -- \\\n  -s hs37d5.fa \\\n  -f hg38.fa \\\n  -c hg19ToHg38.over.chain.gz \\\n  --reject ieu-a-2-reject.vcf.gz \\\n  --reject-type z |\n  bcftools sort -Oz -o ieu-a-2-hg38.vcf.gz -W=tbi\n\n\n\nexport BCFTOOLS_PLUGINS=~/bin/bcftools-plugins\nbcftools\n\nbcftools +liftover --no-version -Ou ieu-a-2.vcf.gz -- \\\n  -s hs37d5.fa \\\n  -f hg38.fa \\\n  -c hg19ToHg38.over.chain.gz \\\n  --reject reject.vcf.gz \\\n  --reject-type z |\n  bcftools sort -Oz -o ieu-a-2_hg38.vcf.gz -W=tbi\n```\n\nIt did 2m variants in about 1 minute.\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.6.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.4 compiler_4.4.1    fastmap_1.2.0     cli_3.6.2        \n [5] tools_4.4.1       htmltools_0.5.8.1 yaml_2.3.8        rmarkdown_2.27   \n [9] knitr_1.47        jsonlite_1.8.8    xfun_0.44         digest_0.6.35    \n[13] rlang_1.1.3       evaluate_0.23    \n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}