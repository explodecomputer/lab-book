{
  "hash": "569ddf74212e6b54d3bc3670918b2733",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Bootstrap p-values example\"\nauthor: Gibran Hemani\ndate: \"2024-11-01\"\ncategories: []\n---\n\n\n## Background\n\nExample of using bootstrapping to get p-values\n\nThis function \n\n- Simulates some data\n- Gets the linear regression p-value\n- Gets the bootstrap p-value\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(purrr)\n\n#' Simulate simple dataset and compare p-values from linear regression and bootstrap\n#' \n#' @param n Number of observations\n#' @param b True effect size\n#' @param nboot Number of bootstrap samples\n#' @param sim Simulation number\n#' \n#' \n#' @return A tibble with p-values\nboot_sim <- function(n, b, nboot, sim=1) {\n    # Simple simulation of y being influenced by x\n    x <- rnorm(n)\n    y <- rnorm(n) + b * x\n\n    # Linear model\n    mod <- summary(lm(y ~ x))\n    bhat <- mod$coefficients[2, 1]\n    pval <- mod$coefficients[2, 4]\n\n    # Get p-value using bootstrap\n    # Generate a null distribution of the slope\n    # Do this by resampling x\n    bboot <- numeric(nboot)\n    for(i in 1:nboot) {\n        x1 <- sample(x)\n        bboot[i] <- lm(y ~ x1)$coefficients[2]\n    }\n\n    # This is a non-parametric p-value\n    pvalboot_nonpara <- sum(abs(bboot) > abs(b)) / nboot\n\n    # This is a parametric p-value\n    pvalboot_para <- pnorm(bhat, mean=mean(bboot), sd=sd(bboot), low=F)\n\n    # Compare parametric pval, non para pval and linear model pval\n    tibble(\n        b=b,\n        n=n,\n        sim=sim,\n        nboot=nboot,\n        pval = pval,\n        pvalboot_nonpara = pvalboot_nonpara,\n        pvalboot_para = pvalboot_para\n    )\n}\n```\n:::\n\n\n\nExample run of this simulation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboot_sim(1000, 0.3, 1000)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 Ã— 7\n      b     n   sim nboot     pval pvalboot_nonpara pvalboot_para\n  <dbl> <dbl> <dbl> <dbl>    <dbl>            <dbl>         <dbl>\n1   0.3  1000     1  1000 1.50e-18                0      1.10e-18\n```\n\n\n:::\n:::\n\n\nTo evaluate performance do it over a range of simulation values\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparam <- expand.grid(\n    n = c(100, 1000, 10000),\n    b = c(0.1, 0.3, 0.5),\n    nboot = c(1000),\n    sim=1:10\n)\n```\n:::\n\n\n\nRun the simulation over the parameter grid\n\n\n::: {.cell}\n\n```{.r .cell-code}\no <- pmap(param, boot_sim) %>% bind_rows()\n```\n:::\n\n\n\nCompare the p-values\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(-log10(o$pval), -log10(o$pvalboot_para))\nabline(0, 1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.6.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] purrr_1.0.2 dplyr_1.1.4\n\nloaded via a namespace (and not attached):\n [1] digest_0.6.37     utf8_1.2.4        R6_2.5.1          fastmap_1.2.0    \n [5] tidyselect_1.2.1  xfun_0.48         magrittr_2.0.3    glue_1.8.0       \n [9] tibble_3.2.1      knitr_1.48        pkgconfig_2.0.3   htmltools_0.5.8.1\n[13] rmarkdown_2.27    generics_0.1.3    lifecycle_1.0.4   cli_3.6.3        \n[17] fansi_1.0.6       vctrs_0.6.5       compiler_4.4.1    tools_4.4.1      \n[21] pillar_1.9.0      evaluate_1.0.1    yaml_2.3.10       rlang_1.1.4      \n[25] jsonlite_1.8.9    htmlwidgets_1.6.4\n```\n\n\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}