{
  "hash": "7689f15d8f554f68161ce260fd7963a6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Expected bias in OLS due to a single confounder\"\nauthor: Gibran Hemani\ndate: \"2024-07-11\"\ncategories: []\n---\n\n\n## Background\n\nAssuming means are 0, for this system:\n\n$$\n\\begin{align}\nx_i &= \\beta_{ux} u_i + e_{xi} \\\\\ny_i &= \\beta_{uy} u_i + \\beta_{xy} x_i + e_{yi} \\\\\nu_i &\\sim N(0, \\sigma^2_u) \\\\\ne_{xi} &\\sim N(0, \\sigma^2_{ex}) \\\\\ne_{yi} &\\sim N(0, \\sigma^2_{ey})\n\\end{align}\n$$\n\nWhat is the expected OLS estimate?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- expand.grid(\n    n = 10000,\n    bux = c(0.1, 0.2, 1, 2),\n    buy = c(0.1, 0.2, 1, 2),\n    bxy = c(0, 0.5),\n    bgu = c(0.1, 0.5),\n    vu = c(1, 0.1, 2),\n    vex = c(0.1, 1, 2),\n    vey = c(0.1, 1, 2)\n)\n\nsim <- function(n, bux, buy, bxy, bgu, vu, vex, vey, ols1=NULL, ols2=NULL, iv1=NULL) {\n    g <- rbinom(n, 2, 0.4)\n    veu <- vu - var(g) * bgu^2\n    if(veu < 0) return(c(NA, NA, NA))\n    eu <- rnorm(n, sd=sqrt(veu))\n    u <- g * bgu + eu\n    ex <- rnorm(n, sd=sqrt(vex))\n    ey <- rnorm(n, sd=sqrt(vey))\n    x <- u * bux + ex\n    y <- u * buy + ey + bxy * x\n    \n    o <- c(\n        lm(y ~ x)$coef[2],\n        lm(y ~ u)$coef[2] * lm(x ~ u)$coef[2] + bxy,\n        lm(y ~ g)$coef[2] / lm(x ~ g)$coef[2]\n    )\n    return(o)\n}\n\nfor(i in 1:nrow(dat)) {\n    a <- do.call(sim, dat[i,])\n    dat$ols1[i] <- a[1]\n    dat$ols2[i] <- a[2] # wrong!\n    dat$iv1[i] <- a[3]\n}\n\ndat$vx <- with(dat, bux^2 * vu + vex)\ndat$ols3 <- with(dat, ((bux * buy + bxy * bux^2) * vu + bxy * vex) / vx)\ndat$ols4 <- with(dat, (bux * buy * vu + bxy * vx) / vx)\ndat$ols5 <- with(dat, bxy + bux * buy * vu / vx)\ndat$rsqux <- with(dat, bux^2 * vu / vx)\ndat$ols6 <- with(dat, bxy + buy / bux * rsqux) # final version\ndat$iv2 <- with(dat, bxy + buy / bux)\n```\n:::\n\n\nUsing the simplified equation where variances aren't included:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(dat$ols1, dat$ols2, xlab=\"OLS\", ylab=\"bux * buy\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nUsing the full equation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(dat$ols1, dat$ols5, xlab=\"OLS\", ylab=\"expected OLS\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(iv2 ~ iv1, data=subset(dat, bux > 0.9), xlab=\"IV\", ylab=\"expected IV\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nExpect that the IV estimate is always more biased than the OLS estimate when instrument arises through U.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(iv2 ~ ols1, dat)\nabline(0, 1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Ventura 13.6\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Rome\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.4 compiler_4.4.1    fastmap_1.2.0     cli_3.6.2        \n [5] tools_4.4.1       htmltools_0.5.8.1 yaml_2.3.8        rmarkdown_2.27   \n [9] knitr_1.47        jsonlite_1.8.8    xfun_0.44         digest_0.6.35    \n[13] rlang_1.1.3       evaluate_0.23    \n```\n\n\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}