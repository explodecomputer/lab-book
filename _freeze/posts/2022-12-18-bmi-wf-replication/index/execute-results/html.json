{
  "hash": "e41b3bfe7879f86c5e0166f8c9fb3079",
  "result": {
    "markdown": "---\ntitle: \"BMI instrument replication\"\nauthor: \"Gibran Hemani\"\nformat: html\neditor: visual\nexecute: \n  cache: true\n---\n\n\n## Background\n\nLiza's analysis of BMI instruments clusters them by PheWAS and finds that cluster 4 relates to SES, and drives BMI-EDU biased effect. Are the instruments in cluster 4 solely due to dynastic confounding? If so they should fail to replicate in the sibling analysis.\n\n## Instruments\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-1_289ef45db63a62f083def06367637c5c'}\n\n```{.r .cell-code}\nlibrary(ieugwasr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nAPI: public: http://gwas-api.mrcieu.ac.uk/\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nbmi_inst <- list(\n  c(\"rs1097327\",\"rs2186120\",\"rs2166172\",\"rs75641275\",\"rs12037698\",\"rs1446585\",\"rs16846140\",\"rs13062093\",\"rs2051559\",\"rs6861649\",\"rs2281819\",\"rs12662900\",\"rs9388681\",\"rs17132130\",\"rs215634\",\"rs79682948\",\"rs2192649\",\"rs13294945\",\"rs7357754\",\"rs4749937\",\"rs1465900\",\"rs1799992\",\"rs55938344\",\"rs7987928\",\"rs7331420\",\"rs9522279\",\"rs55689274\",\"rs4777541\",\"rs7189149\",\"rs11079849\",\"rs113230003\",\"rs150998792\"),\n  c(\"rs3737992\",\"rs1167311\",\"rs12140153\",\"rs34361149\",\"rs12049202\",\"rs2181375\",\"rs17024393\",\"rs61813324\",\"rs815163\",\"rs2678204\",\"rs17014332\",\"rs563738408\",\"rs6751993\",\"rs4671328\",\"rs6545714\",\"rs4482463\",\"rs815715\",\"rs6769617\",\"rs1225004\",\"rs355777\",\"rs6776471\",\"rs869400\",\"rs4261944\",\"rs1296328\",\"rs6867471\",\"rs2307111\",\"rs28404639\",\"rs7442885\",\"rs55838622\",\"rs13174863\",\"rs146696797\",\"rs9368828\",\"rs34045288\",\"rs72892910\",\"rs2482398\",\"rs2253310\",\"rs765874\",\"rs9688977\",\"rs6950388\",\"rs4722398\",\"rs1470749\",\"rs147678035\",\"rs39330\",\"rs1805123\",\"rs6601527\",\"rs791405\",\"rs12679106\",\"rs201519328\",\"rs9297524\",\"rs17770336\",\"rs2440589\",\"rs3931548\",\"rs3861879\",\"rs2356376\",\"rs17399739\",\"rs6265\",\"rs491711\",\"rs7942037\",\"rs10898330\",\"rs12364470\",\"rs55726687\",\"rs1458156\",\"rs7138383\",\"rs147730268\",\"rs9507895\",\"rs10507483\",\"rs11148421\",\"rs1949204\",\"rs1441264\",\"rs7990098\",\"rs8015400\",\"rs7141420\",\"rs1286138\",\"rs6575340\",\"rs12881629\",\"rs3803286\",\"rs7183417\",\"rs4776970\",\"rs2870111\",\"rs2046002\",\"rs56803094\",\"rs12926311\",\"rs879620\",\"rs7193783\",\"rs4402589\",\"rs11642015\",\"rs117342986\",\"rs11150461\",\"rs4790841\",\"rs56161855\",\"rs11150745\",\"rs9319615\",\"rs57636386\",\"rs111640872\",\"rs3810291\",\"rs6050446\",\"rs67844506\",\"rs6001870\"),\n  c(\"rs12024554\",\"rs35722922\",\"rs593010\",\"rs10803762\",\"rs6772763\",\"rs80082351\",\"rs1471740\",\"rs2606228\",\"rs13107325\",\"rs13176429\",\"rs1919243\",\"rs286818\",\"rs3844598\",\"rs7755574\",\"rs3843540\",\"rs17716502\",\"rs1411432\",\"rs2267958\",\"rs2450447\",\"rs11826177\",\"rs7124681\",\"rs317687\",\"rs3897102\",\"rs9506311\",\"rs35193668\",\"rs3759584\",\"rs862320\",\"rs7774\",\"rs8078135\",\"rs11653258\",\"rs56212061\",\"rs11084554\",\"rs2153740\",\"rs8134638\",\"rs2837398\"),\n  c(\"rs115866895\",\"rs6687953\",\"rs935166\",\"rs13002946\",\"rs72820274\",\"rs12619626\",\"rs13427822\",\"rs72967047\",\"rs9843653\",\"rs1454687\",\"rs34811474\",\"rs17085463\",\"rs1383723\",\"rs35853157\",\"rs1503526\",\"rs1477290\",\"rs9463511\",\"rs9277992\",\"rs236660\",\"rs2045293\",\"rs10954772\",\"rs77883185\",\"rs35529153\",\"rs11782074\",\"rs2398861\",\"rs7030732\",\"rs61845249\",\"rs4595495\",\"rs61903695\",\"rs1048932\",\"rs2292238\",\"rs116394958\",\"rs2933223\",\"rs217672\",\"rs2333012\",\"rs11855853\",\"rs62037365\",\"rs34966008\",\"rs1788808\",\"rs784257\",\"rs11666480\"),\n  c(\"rs4648450\",\"rs12031634\",\"rs1778830\",\"rs61826867\",\"rs170553\",\"rs10185199\",\"rs6545144\",\"rs3806572\",\"rs2861685\",\"rs7557796\",\"rs72844755\",\"rs115584509\",\"rs35882248\",\"rs34373881\",\"rs4377469\",\"rs75557510\",\"rs2035936\",\"rs66679256\",\"rs73213484\",\"rs6831020\",\"rs11099020\",\"rs750090\",\"rs6536575\",\"rs7701777\",\"rs9291822\",\"rs10059453\",\"rs2118793\",\"rs4921301\",\"rs4467770\",\"rs7453694\",\"rs9342196\",\"rs9489620\",\"rs13210756\",\"rs3807652\",\"rs7810870\",\"rs7461253\",\"rs2616192\",\"rs12681792\",\"rs55781253\",\"rs13289199\",\"rs2254331\",\"rs1327808\",\"rs6597653\",\"rs2439823\",\"rs6591\",\"rs75936055\",\"rs34292685\",\"rs7940866\",\"rs329651\",\"rs12422552\",\"rs4761401\",\"rs1901241\",\"rs11613680\",\"rs9579775\",\"rs7995015\",\"rs9527895\",\"rs9522183\",\"rs145946602\",\"rs8027969\",\"rs117632017\",\"rs113182412\",\"rs756717\",\"rs11656076\",\"rs2332306\",\"rs7237783\",\"rs1942826\",\"rs45486197\",\"rs76040172\",\"rs28489620\"),\n  c(\"rs61743745\",\"rs10921760\",\"rs2141004\",\"rs754481\",\"rs80330591\",\"rs199750218\",\"rs12479357\",\"rs4485556\",\"rs2569993\",\"rs9847186\",\"rs13076052\",\"rs762705\",\"rs550669262\",\"rs10865612\",\"rs6780459\",\"rs73169730\",\"rs10938397\",\"rs35851183\",\"rs190301182\",\"rs1428120\",\"rs245775\",\"rs1775255\",\"rs2749929\",\"rs6973656\",\"rs12537134\",\"rs1425717\",\"rs11012732\",\"rs12260817\",\"rs112921972\",\"rs61871615\",\"rs10749233\",\"rs845084\",\"rs67609008\",\"rs2035806\",\"rs12575252\",\"rs555754158\",\"rs2234458\",\"rs704061\",\"rs13353100\",\"rs7498044\",\"rs2342892\",\"rs55931203\",\"rs60764613\",\"rs2155869\",\"rs1389067\",\"rs2247593\",\"rs273505\",\"rs10404726\",\"rs112693590\")\n)\n```\n:::\n\n\nExtract instruments from the population and sibling GWASs\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-2_aed1915f03faa302bfc2faeabfa10950'}\n\n```{.r .cell-code}\nwfest <- ieugwasr::associations(unlist(bmi_inst), \"ieu-b-4815\")\npopest <- ieugwasr::associations(unlist(bmi_inst), \"ieu-b-4816\")\ngiantest <- ieugwasr::associations(unlist(bmi_inst), \"ieu-b-40\")\nukbest <- ieugwasr::associations(unlist(bmi_inst), \"ukb-b-19953\")\n```\n:::\n\n\nReplication rates function\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-3_cd58fd51fc3965a4e7f1a8761722e14e'}\n\n```{.r .cell-code}\nexp_rep <- function(b_disc, b_rep, se_disc, se_rep, alpha)\n{\n  p_sign <- pnorm(-abs(b_disc) / se_disc) * pnorm(-abs(b_disc) / se_rep) + ((1 - pnorm(-abs(b_disc) / se_disc)) * (1 - pnorm(-abs(b_disc) / se_rep)))\n  p_sig <- pnorm(-abs(b_disc) / se_rep + qnorm(alpha / 2)) + (1 - pnorm(-abs(b_disc) / se_rep - qnorm(alpha / 2)))\n  p_rep <- pnorm(abs(b_rep)/se_rep, lower.tail=FALSE)\n  res <- tibble::tibble(\n    nsnp=length(b_disc),\n    metric=c(\"Sign\", \"Sign\", \"P-value\", \"P-value\"),\n    datum=c(\"Expected\", \"Observed\", \"Expected\", \"Observed\"),\n    value=c(sum(p_sign, na.rm=TRUE), sum(sign(b_disc) == sign(b_rep)), sum(p_sig, na.rm=TRUE), sum(p_rep < alpha, na.rm=TRUE))\n  )\n  return(list(res=res, variants=dplyr::tibble(sig=p_sig, sign=p_sign)))\n}\n```\n:::\n\n\nAnalysis\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-4_4552e4705e30c261698b232ad2a2f518'}\n\n```{.r .cell-code}\nests <- bind_rows(giantest, wfest, popest, ukbest) %>%\n  mutate(cluster=NA)\nfor(i in 1:length(bmi_inst))\n{\n  ests$cluster[ests$rsid %in% bmi_inst[[i]]] <- i\n}\n\nests %>%\n  group_by(id, cluster) %>%\n  summarise(n=n(), psig = sum(p < 5e-3)/n) %>%\n  ggplot(., aes(x=as.factor(cluster), y=psig)) +\n  geom_bar(position=\"dodge\", stat=\"identity\", aes(fill=id))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'id'. You can override using the `.groups`\nargument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nExpected vs observed replication rates\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-5_a81b60b22e4119f24f18134f3ea00fbc'}\n\n```{.r .cell-code}\no <- lapply(1:length(bmi_inst), function(i)\n{\n  x <- bmi_inst[[i]]\n  dat <- inner_join(\n    subset(popest, rsid %in% x),\n    subset(wfest, rsid %in% x),\n    by=\"rsid\"\n  )\n  exp_rep(dat$beta.x, dat$beta.y, dat$se.x, dat$se.y, 1e-3)[[1]] %>%\n    mutate(cluster=i)\n})\no %>% bind_rows() %>%\n  ggplot(aes(x=as.factor(cluster), y=value/nsnp)) +\n  geom_point(aes(colour=datum)) +\n  facet_grid(. ~ metric) +\n  labs(x=\"Cluster\", y=\"Fraction of sig. instruments\", colour=\"\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Summary\n\nAll clusters appear to replicate as expected in the within-family GWAS, which is consistent with there being almost no shrinkage of the effect sizes.\n\n## Childhood vs adulthood relationship to SES\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-6_a4f1a232ed483e0fc4a0af62a8dcf5ce'}\n\n```{.r .cell-code}\nlibrary(TwoSampleMR)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nTwoSampleMR version 0.5.6 \n[>] New: Option to use non-European LD reference panels for clumping etc\n[>] Some studies temporarily quarantined to verify effect allele\n[>] See news(package='TwoSampleMR') and https://gwas.mrcieu.ac.uk for further details\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'TwoSampleMR'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:ieugwasr':\n\n    ld_matrix\n```\n:::\n\n```{.r .cell-code}\nchild <- make_dat(\"ukb-b-10011\", \"ebi-a-GCST90002409\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nExtracting data for 18 SNP(s) from 1 GWAS(s)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nHarmonising Townsend deprivation index at recruitment || id:ukb-b-10011 (ukb-b-10011) and Childhood body mass index || id:ebi-a-GCST90002409 (ebi-a-GCST90002409)\n```\n:::\n\n```{.r .cell-code}\nmr(child) %>% select(nsnp, b, se, pval)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nAnalysing 'ukb-b-10011' on 'ebi-a-GCST90002409'\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n  nsnp           b        se      pval\n1   18  0.00605344 1.4172450 0.9966448\n2   18 -0.07468209 0.2308366 0.7462954\n3   18 -0.05801819 0.2184155 0.7905224\n4   18 -0.11644263 0.4977415 0.8178241\n5   18 -0.11644263 0.4702948 0.8074135\n```\n:::\n:::\n\n::: {.cell hash='index_cache/html/unnamed-chunk-7_e58e09ab5c1b3f87e284cfbe36d775ee'}\n\n```{.r .cell-code}\nadult <- make_dat(\"ukb-b-10011\", \"ukb-b-19953\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nExtracting data for 18 SNP(s) from 1 GWAS(s)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nHarmonising Townsend deprivation index at recruitment || id:ukb-b-10011 (ukb-b-10011) and Body mass index (BMI) || id:ukb-b-19953 (ukb-b-19953)\n```\n:::\n\n```{.r .cell-code}\nmr(adult) %>% select(nsnp, b, se, pval)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nAnalysing 'ukb-b-10011' on 'ukb-b-19953'\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n  nsnp          b         se         pval\n1   18 -0.2812238 0.80612571 7.317440e-01\n2   18  0.3450191 0.07873753 1.176549e-05\n3   18  0.4835539 0.13327136 2.852487e-04\n4   18  0.3588983 0.15546210 3.380204e-02\n5   18  0.3128024 0.12623146 2.400304e-02\n```\n:::\n:::\n\n\nReplication of clustered instruments from adult to child\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-8_8b4ae0752d2fb6ddef5dd397601559ef'}\n\n```{.r .cell-code}\nukbest <- ieugwasr::associations(unlist(bmi_inst), \"ukb-b-19953\")\nchildest <- ieugwasr::associations(unlist(bmi_inst), \"ebi-a-GCST90002409\")\n```\n:::\n\n::: {.cell hash='index_cache/html/unnamed-chunk-9_2fa958bac462e15ebc83d08ad9fb3d76'}\n\n```{.r .cell-code}\no1 <- lapply(1:length(bmi_inst), function(i)\n{\n  x <- bmi_inst[[i]]\n  dat <- inner_join(\n    subset(ukbest, rsid %in% x),\n    subset(childest, rsid %in% x),\n    by=\"rsid\"\n  )\n  exp_rep(dat$beta.x, dat$beta.y, dat$se.x, dat$se.y, 1e-3)[[1]] %>%\n    mutate(cluster=i)\n})\no1 %>% bind_rows() %>%\n  ggplot(aes(x=as.factor(cluster), y=value/nsnp)) +\n  geom_point(aes(colour=datum)) +\n  facet_grid(. ~ metric) +\n  labs(x=\"Cluster\", y=\"Fraction of sig. instruments\", colour=\"\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Summary\n\n-   SES has an influence on BMI in adulthood but not childhood\n\n-   The replication rate amongst clusters appears to be relatively consistent, except cluster 2 replicates particularly well\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}