{
  "hash": "41ee23daab1631a0b0a0a86f973053b9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Estimating environmental factor using GxE interaction\"\nauthor: Gibran Hemani\ndate: \"2025-01-21\"\ncategories: []\n---\n\n\n## Background\n\nIs it possible to estimate the environmental factor using the GxE interaction term? In this model the genetic effect is masked unless individuals experience a particular environment. Stratifying individuals by different levels of environmental exposure will give different marginal genetic effects. Can the influence of the environment be recovered from this?\n\n## Initial simulation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(purrr)\nlibrary(ggplot2)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfn <- function(n, bap, bm, bi, sim=1) {\n    args <- list(n=n, bap=bap, bm=bm, bi=bi, sim=sim) %>% as_tibble()\n    ap <- rbinom(n, 2, 0.5) / 2\n    g <- rbinom(n, 2, 0.3)\n\n    l <- ap * bap + g * ap * bi + rnorm(n)\n    copd <- rbinom(n, 1, plogis(l))\n    bhat <- glm(copd ~ g * ap, family=\"binomial\")$coef[4]\n    args$bhat <- bhat\n    return(args)\n}\nfn(100000, 0.3, 0.1, 0.5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 Ã— 6\n       n   bap    bm    bi   sim  bhat\n   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n1 100000   0.3   0.1   0.5     1 0.439\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nparam <- expand.grid(\n    n=100000,\n    bap=c(0.1, 0.3, 0.5),\n    bm=c(0, 0.1),\n    bi=c(0.1, 0.3, 0.5),\n    sim=1:5\n)\nres <- pmap(param, fn)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres %>% \n    bind_rows() %>%\n    ggplot(aes(bap, bhat, color=factor(bi))) +\n    geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nUntidy sims:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(simulateGP)\n\nn <- 10000\nG <- correlated_binomial(n, 0.3, 0.1, 0.5)\ndim(G)\ncor(G)\n\nlm(G[,1] ~ G[,2])\n\nx <- G[,1] + rnorm(n)\n\nlm(x ~ G[,2])\n\ncor(G) * (sd(G[,1]) / sd(G[,2]))\n\n\n\n\n\n\n\nn <- 100000\nap <- rbinom(n, 2, 0.5) / 2\ng <- rbinom(n, 2, 0.3)\n\nb <- 1.2\n\nl <- ap * b + g + g * ap + rnorm(n)\ncopd <- rbinom(n, 1, plogis(l))\n\nb0 <- glm(copd ~ g, family=\"binomial\", subset=ap==0)$coef[2]\nb1 <- glm(copd ~ g, family=\"binomial\", subset=ap==1)$coef[2]\nb2 <- glm(copd ~ g, family=\"binomial\", subset=ap==2)$coef[2]\n\nb0\nb1\nb2\n\nb2 <- glm(copd ~ g * ap, family=\"binomial\")\n\n\nfn <- function(n, bap, bm, bi, sim=1) {\n    args <- list(n=n, bap=bap, bm=bm, bi=bi, sim=sim) %>% as_tibble()\n    ap <- rbinom(n, 2, 0.5) / 2\n    g <- rbinom(n, 2, 0.3)\n\n    l <- ap * bap + g * ap * bi + rnorm(n)\n    copd <- rbinom(n, 1, plogis(l))\n    bhat <- glm(copd ~ g * ap, family=\"binomial\")$coef[4]\n    args$bhat <- bhat\n    return(args)\n}\n\nparam <- expand.grid(\n    n=100000,\n    bap=c(0.1, 0.3, 0.5),\n    bm=c(0, 0.1),\n    bi=c(0.1, 0.3, 0.5),\n    sim=1:5\n)\n\nfn(100000, 0.3, 0.1, 0.5)\n\nlibrary(purrr)\nres <- pmap(param, fn)\n\n\nlibrary(ggplot2)\n\nres %>% \n    bind_rows() %>%\n    ggplot(aes(bap, bhat, color=factor(bi))) +\n    geom_point()\n```\n:::\n\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.3 (2025-02-28)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.6.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] dplyr_1.1.4   ggplot2_3.5.1 purrr_1.0.2  \n\nloaded via a namespace (and not attached):\n [1] vctrs_0.6.5       cli_3.6.3         knitr_1.48        rlang_1.1.4      \n [5] xfun_0.48         generics_0.1.3    jsonlite_1.8.9    labeling_0.4.3   \n [9] glue_1.8.0        colorspace_2.1-1  htmltools_0.5.8.1 scales_1.3.0     \n[13] fansi_1.0.6       rmarkdown_2.27    grid_4.4.3        evaluate_1.0.1   \n[17] munsell_0.5.1     tibble_3.2.1      fastmap_1.2.0     yaml_2.3.10      \n[21] lifecycle_1.0.4   compiler_4.4.3    htmlwidgets_1.6.4 pkgconfig_2.0.3  \n[25] farver_2.1.2      digest_0.6.37     R6_2.5.1          tidyselect_1.2.1 \n[29] utf8_1.2.4        pillar_1.9.0      magrittr_2.0.3    withr_3.0.2      \n[33] tools_4.4.3       gtable_0.3.6     \n```\n\n\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}