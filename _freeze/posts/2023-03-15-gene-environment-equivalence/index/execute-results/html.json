{
  "hash": "f1ddd676d17124667ca021644388a622",
  "result": {
    "markdown": "---\ntitle: \"Gene-environment equivalence\"\nauthor: Gibran Hemani\ndate: \"2023-03-15\"\ncategories: []\n---\n\n\n## Background\n\nLatest PRS for height explains \\~40% of the variance. Heritability \\~0.7. Height has a negative association with coronary heart disease. Height is fixed after adolescence, which means it can only be influenced by a) genetic factors; b) early life exposures; c) stochasticity.\n\nQuestion: Is the influence of height on CHD different when the modifier is genetic vs non-genetic?\n\nAnalysis: Estimate the association of height PRS on CHD, and then residualise height for the PRS and determine the residual height association with CHD.\n\n## Model\n\n### Gene environment equivalence\n\nUnder gene-environment equivalence, the following model:\n\n$$\ny_i = \\alpha + \\beta_{xy} x_i + \\epsilon_i\n$$\n\nwhere $y_i$ is the outcome (e.g. CHD), $\\beta_{xy}$ is the causal effect of the exposure on the outcome and\n\n$$\nx_i = a + \\sqrt{h^2} g_i + \\sqrt{1-h^2} e_i\n$$\n\nwhere $x_i$ is the exposure (height) in the $i$th individual, $h^2$ is the heritability of height, $g_i$ is the (perfectly measured) genetic value for individual $i$ and $e_i$ is the non-genetic component of height. There is no confounding in this simple model. **What is the expected association of g on y?**\n\n$$\n\\begin{aligned}\n\\beta_{gy} &= \\frac{cov(y, g)}{var(g)} \\\\\n&= \\frac{cov(\\beta_{xy}x, g)}{ var(g) } \\\\\n&= \\frac{cov(\\beta_{xy}\\sqrt{h^2}g, g)}{ var(g) } \\\\\n&= \\frac{\\beta_{xy}\\sqrt{h^2}var(g)}{ var(g) } \\\\\n&= \\beta_{xy}\\sqrt{h^2}\n\\end{aligned}\n$$\n\nSo this is expected and the basic result for MR. **What is the expected association of x on y after it has been residualised for g?** First get the residual assuming perfect information of $g$\n\n$$\n\\begin{aligned}\n\\hat{e_i} &= x_i - \\hat{\\sqrt{h^2}}g_i \\\\\n&\\approx \\sqrt{1-h^2}e_i\n\\end{aligned}\n$$\n\nNow find the association of $\\hat{e}_i$ with $y_i$\n\n$$\n\\begin{aligned}\n\\beta_{\\hat{e}y} &= \\frac{cov(\\hat{e}, y)}{var(\\hat{e})} \\\\\n&= \\frac{cov(\\sqrt{1-h^2}e, \\beta_{xy}(\\sqrt{1-h^2}e)}{(1-h^2)var(e)} \\\\\n&= \\frac{\\beta_{xy}(1-h^2)var(e)}{(1-h^2)var(e)} \\\\\n&= \\beta_{xy}\n\\end{aligned}\n$$\n\n**RESULT:** The residual height association with y is expected to be equal to the raw height association with y.\n\n### Gene environment non-equivalence\n\nNow allow the genetic and non-genetic components of height to have independent influences on CHD.\n\n$$\nx_i = \\sqrt{h^2}g_i + \\sqrt{1-h^2}e_i\n$$\n\nas before, and now\n\n$$\ny_i = \\beta_g g_i + \\beta_e e_i + \\epsilon_i\n$$\n\nExpected association of x on y\n\n$$\n\\begin{aligned}\n\\beta_{xy} &= \\frac{cov(\\sqrt{h^2}g_i + \\sqrt{1-h^2}e_i,\\beta_g g_i + \\beta_e e_i)}{var(x)} \\\\\n&= \\frac{\\sqrt{h^2}\\beta_g var(g) + \\sqrt{1-h^2}\\beta_e var(e)}{h^2 var(g) + (1-h^2) var(e)} \\\\\n\\end{aligned}\n$$\n\nAssuming $var(g)=var(e)=1$ this reduces to\n\n$$\n\\beta_{xy} = \\sqrt{h^2}\\beta_g + \\sqrt{1-h^2}\\beta_e\n$$\n\n**Now what is the expected association of x on y after it has been residualised for g?**\n\n$$\n\\begin{aligned}\n\\beta_{\\hat{e}y} &= cov(\\hat{e}, y) / var(\\hat{e}) \\\\\n&= \\frac{cov(\\sqrt{1-h^2}e, \\beta_g g + \\beta_e e)}{(1-h^2)var(e)} \\\\\n&= \\frac{\\sqrt{1-h^2}\\beta_evar(e)}{(1-h^2)var(e)} \\\\\n&= \\sqrt{\\frac{(1-h^2)\\beta_e^2 var(e)^2}{(1-h^2)^2 var(e)^2}} \\\\\n&= \\frac{\\beta_e}{\\sqrt{1-h^2}}\n\\end{aligned}\n$$\n\n## Check with simulations\n\n### Gene environment equivalence\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 100000\nbxy <- 0.3\nh2 <- 0.7\ng <- rnorm(n)\ne <- rnorm(n)\nx <- sqrt(h2) * g + sqrt(1-h2) * e\ny <- x * bxy + rnorm(n)\n```\n:::\n\n\nGet residual\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxres <- residuals(lm(x ~ g)) # sim\nxres_exp <- sqrt(1-h2) * e # expected\n# check they're the same\ncor(xres, xres_exp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.9999983\n```\n:::\n\n```{.r .cell-code}\nlm(xres ~ xres_exp)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n xres_exp \n0.9999965 \n```\n:::\n:::\n\n\nAssoc of x on y should be\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ x)$coef[2] # sim\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        x \n0.3000927 \n```\n:::\n\n```{.r .cell-code}\nbxy # expected\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.3\n```\n:::\n:::\n\n\nExpected assoc of g on y\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ g)$coef[2] # sim\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        g \n0.2522619 \n```\n:::\n\n```{.r .cell-code}\nsqrt(h2)*bxy # expected\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.250998\n```\n:::\n:::\n\n\nExpected assoc of residual x on y\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ xres)$coef[2] # sim\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     xres \n0.2976635 \n```\n:::\n\n```{.r .cell-code}\nbxy\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.3\n```\n:::\n:::\n\n\n### Gene environment non-equivalence\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 100000\nbg <- 0.3\nbe <- 0.6\nh2 <- 0.7\ng <- rnorm(n)\ne <- rnorm(n)\nx <- sqrt(h2) * g + sqrt(1-h2) * e\ny <- g * bg + e * be + rnorm(n)\n```\n:::\n\n\nGet residual\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxres <- residuals(lm(x ~ g)) # sim\nxres_exp <- sqrt(1-h2) * e # expected\n# check they're the same\ncor(xres, xres_exp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.9999999\n```\n:::\n\n```{.r .cell-code}\nlm(xres ~ xres_exp)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n xres_exp \n0.9999998 \n```\n:::\n:::\n\n\nAssociation of xres and y\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ xres)$coef[2] # sim\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    xres \n1.093426 \n```\n:::\n\n```{.r .cell-code}\nbe / sqrt(1-h2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1.095445\n```\n:::\n:::\n\n\nAssoc of x and y - simulation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ x)$coef[2] # sim\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       x \n0.582287 \n```\n:::\n\n```{.r .cell-code}\nbg * sqrt(h2) + be * sqrt(1-h2) # exp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.5796315\n```\n:::\n:::\n\n\n## Incomplete adjustment of g\n\nDoes incomplete adjustment of g change things much?\n\n### Gene environment equivalence\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 100000\nbxy <- 0.3\nh2 <- 0.7\ng_exp <- 0.5 # proportion of g explained by prs\ng_explained <- rnorm(n) * sqrt(g_exp)\ng_unexplained <- rnorm(n) * sqrt(1-g_exp)\ng <- g_explained + g_unexplained\ne <- rnorm(n)\nx <- sqrt(h2) * g + sqrt(1-h2) * e\ny <- x * bxy + rnorm(n)\n```\n:::\n\n\nGet residual - now this is different from expected above due to residual including some unadjusted genetic variance, but linearly still related\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxres <- residuals(lm(x ~ g_explained)) # sim\nxres_exp <- sqrt(1-h2) * e # expected\n# check they're the same\ncor(xres, xres_exp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6816312\n```\n:::\n\n```{.r .cell-code}\nlm(xres ~ xres_exp)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nxres_exp \n1.002391 \n```\n:::\n:::\n\n\nWhat is the PRS (explained g) assoc with y?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ g_explained)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ng_explained \n  0.2456972 \n```\n:::\n:::\n\n\nAssoc of height with y\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ x)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        x \n0.2990685 \n```\n:::\n:::\n\n\nAnd residual with y\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ xres)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     xres \n0.3008428 \n```\n:::\n:::\n\n\n**So the residual x effect remains identical to the raw effect of x.**\n\n## In progress... (ignore for now)\n\nDoes confounding change things much?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 100000\nbxy <- 0.3\nbu <- 0.3\nh2 <- 0.7\nu <- rnorm(n)\ng <- rnorm(n)\ne <- rnorm(n)\nx <- sqrt(h2) * g + sqrt(1-h2) * e + u * bu\ny <- x * bxy + rnorm(n) + u * bu\n```\n:::\n\n\ny \\~ x\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ x)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        x \n0.3776938 \n```\n:::\n:::\n\n\ny \\~ x_res\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxres <- residuals(lm(x ~ g)) # sim\nxres_exp <- sqrt(1-h2) * e # expected\n# check they're the same\ncor(xres, xres_exp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.8774442\n```\n:::\n\n```{.r .cell-code}\nlm(xres ~ xres_exp)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nxres_exp \n 1.00079 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ xres)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     xres \n0.5212565 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ xres_exp)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n xres_exp \n0.2893803 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ g)$coef[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        g \n0.2492456 \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}