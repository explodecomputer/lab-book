{
  "hash": "dd5932c79cf5b454d292da169c26ab2f",
  "result": {
    "markdown": "---\ntitle: \"Metabolite power calculation\"\nauthor: Gibran Hemani and Nic Timpson\ndate: \"2023-01-26\"\ncategories: [power calculation]\nformat:\n  html:\n    embed-resources: true\n---\n\n\n## Background\n\nSample of individuals who have had heart surgery, followed up and some number go on to have kidney disease. What is the predictive rsq of a metabolite on kidney disease outcome, that has 80% power to be detected after multiple testing correction?\n\n## Simulation\n\nCall libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fmsb)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n```\n:::\n\n\nDefine model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim <- function(ncase, ncontrol, b)\n{\n  met <- rnorm(ncase+ncontrol)\n  y <- rbinom(ncase+ncontrol, 1, plogis(log(ncase/(ncase+ncontrol)) + met*b + rnorm(ncase+ncontrol)))\n  table(y)\n  mod <- glm(y ~ met)\n  rsq <- NagelkerkeR2(mod)$R2\n  pval <- summary(mod)$coef[2,4]\n  return(tibble(rsq, pval, ncase, ncontrol, b))\n}\n```\n:::\n\n\nSet parameters\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Parameters\nntest <- 1500\nncase <- 70\nncontrol <- 100\n```\n:::\n\n\nRun\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparam <- expand.grid(\n  b = seq(0, 1.5, by=0.01),\n  sim = 1:100\n)\nres <- lapply(1:nrow(param), function(i) {\n  sim(ncase=ncase, ncontrol=ncontrol, b=param$b[i])\n}) %>% bind_rows()\n```\n:::\n\n\nVisualise\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres %>% group_by(b) %>%\n  summarise(rsq=mean(rsq), psig = sum(pval < (0.05/ntest))/n()) %>%\n  ggplot(., aes(x=rsq, y=psig)) +\n  geom_point() +\n  geom_hline(yintercept=0.8) +\n  labs(x=\"Negelkerke R2\", y=\"Power\", title=paste0(ncase, \" cases, \", ncontrol, \" controls, \", ntest, \" independent tests\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.2.1 Patched (2022-09-06 r82817)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Monterey 12.6.2\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib\nLAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib\n\nlocale:\n[1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] ggplot2_3.4.0 dplyr_1.0.10  fmsb_0.7.5   \n\nloaded via a namespace (and not attached):\n [1] knitr_1.41        magrittr_2.0.3    munsell_0.5.0     tidyselect_1.2.0 \n [5] colorspace_2.0-3  R6_2.5.1          rlang_1.0.6       fastmap_1.1.0    \n [9] fansi_1.0.3       stringr_1.5.0     tools_4.2.1       grid_4.2.1       \n[13] gtable_0.3.1      xfun_0.36         utf8_1.2.2        DBI_1.1.3        \n[17] cli_3.5.0         withr_2.5.0       htmltools_0.5.4   assertthat_0.2.1 \n[21] yaml_2.3.6        digest_0.6.31     tibble_3.1.8      lifecycle_1.0.3  \n[25] farver_2.1.1      htmlwidgets_1.5.4 vctrs_0.5.1       glue_1.6.2       \n[29] evaluate_0.19     rmarkdown_2.16    labeling_0.4.2    stringi_1.7.8    \n[33] compiler_4.2.1    pillar_1.8.1      scales_1.2.1      generics_0.1.3   \n[37] jsonlite_1.8.4    pkgconfig_2.0.3  \n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}