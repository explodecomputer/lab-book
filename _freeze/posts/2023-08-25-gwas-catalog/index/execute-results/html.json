{
  "hash": "5e77b83c8cb880283b2d71c1c3755cdb",
  "result": {
    "markdown": "---\ntitle: \"GWAS catalog traits\"\nauthor: Gibran Hemani\ndate: \"2023-08-25\"\ncategories: []\n---\n\n\n## Background\n\nIdentify GWAS catalog traits to import to OpenGWAS\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(data.table)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'data.table'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:dplyr':\n\n    between, first, last\n```\n:::\n\n```{.r .cell-code}\nlibrary(ieugwasr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nAPI: public: http://gwas-api.mrcieu.ac.uk/\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n```\n:::\n\n\nGet list of harmonised studies in GWAS catalog\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndownload.file(\"ftp://ftp.ebi.ac.uk/pub/databases/gwas/summary_statistics/harmonised_list.txt\", \"harmonised_list.txt\")\na <- scan(\"harmonised_list.txt\", what=character())\nhead(a)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"./GCST90086001-GCST90087000/GCST90086737/harmonised/35078996-GCST90086737-EFO_0007937.h.tsv.gz\"\n[2] \"./GCST90086001-GCST90087000/GCST90086591/harmonised/35078996-GCST90086591-EFO_0007937.h.tsv.gz\"\n[3] \"./GCST90086001-GCST90087000/GCST90086659/harmonised/35078996-GCST90086659-EFO_0007937.h.tsv.gz\"\n[4] \"./GCST90086001-GCST90087000/GCST90086510/harmonised/35078996-GCST90086510-EFO_0007937.h.tsv.gz\"\n[5] \"./GCST90086001-GCST90087000/GCST90086758/harmonised/35078996-GCST90086758-EFO_0007937.h.tsv.gz\"\n[6] \"./GCST90086001-GCST90087000/GCST90086480/harmonised/35078996-GCST90086480-EFO_0007937.h.tsv.gz\"\n```\n:::\n:::\n\n\nGet EBI IDs already in OpenGWAS\n\n\n::: {.cell}\n\n```{.r .cell-code}\nao <- ieugwasr::gwasinfo()\ngotebi <- grep(\"ebi-a\", ao$id, value=TRUE) %>% gsub(\"ebi-a-\", \"\", .)\n```\n:::\n\n\nIdentify datasets not available\n\n\n::: {.cell}\n\n```{.r .cell-code}\na <- tibble(path=a) %>%\n    tidyr::separate(path, sep=\"/\", into=c(\"dot\", \"range\", \"id\", \"harmonised\", \"fn\"), remove=FALSE) %>% \n    as_tibble %>%\n    tidyr::separate(fn, sep=\"-\", into=c(\"pmid\", \"id2\", \"efo\"), remove=FALSE) %>%\n    filter(!is.na(id2)) %>%\n    filter(!id %in% gotebi) %>%\n    dplyr::select(-c(id2, dot)) %>%\n    mutate(path=gsub(\"^./\", \"\", path))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Expected 3 pieces. Missing pieces filled with `NA` in 4427 rows [4005, 4006,\n4007, 4008, 4009, 4010, 4011, 4012, 4013, 4014, 4015, 4016, 4017, 4018, 4019,\n4020, 4021, 4022, 4023, 4024, ...].\n```\n:::\n\n```{.r .cell-code}\na\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 22,932 × 7\n   path                                 range id    harmonised fn    pmid  efo  \n   <chr>                                <chr> <chr> <chr>      <chr> <chr> <chr>\n 1 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n 2 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n 3 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n 4 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n 5 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n 6 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n 7 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n 8 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n 9 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n10 GCST90086001-GCST90087000/GCST90086… GCST… GCST… harmonised 3507… 3507… EFO_…\n# ℹ 22,922 more rows\n```\n:::\n:::\n\n\nThere are 4427 that have no pmid, remove for now.\n\nSummarise how many studies by pmid:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nas <- a %>% group_by(pmid) %>% summarise(n=n()) %>% arrange(desc(n))\nas %>% head(n=20)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 20 × 2\n   pmid         n\n   <chr>    <int>\n 1 34662886  7972\n 2 35078996  4753\n 3 34737426  2939\n 4 35668104  1863\n 5 33983923  1021\n 6 34503513   922\n 7 35115689   469\n 8 34594039   429\n 9 35115690   412\n10 33437055   337\n11 35213538   249\n12 34017140   161\n13 33414548   134\n14 33959723   115\n15 35264221   110\n16 33328453   106\n17 34226706    53\n18 29892013    46\n19 33623009    45\n20 33283231    43\n```\n:::\n:::\n\n\nHow many traits per study?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqplot(y=as$n, x=1:nrow(as)) +\nscale_y_log10() +\nlabs(y=\"Number of traits in study\", x=\"Study\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: `qplot()` was deprecated in ggplot2 3.4.0.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nHow many traits to import if we only keep studies with fewer than 1000 traits\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsubset(as, n <= 1000) %>% {sum(.$n)}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 4384\n```\n:::\n:::\n\n\nHow many traits to import if we only keep studies with fewer than 200 traits\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsubset(as, n <= 200) %>% {sum(.$n)}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1566\n```\n:::\n:::\n\n\nStudies to ignore (for now at least)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npmid_ignore <- c(\n    34662886, # rare variant aggregate enrichment of ukb exome data\n    35078996, # pqtl\n    34737426, # ukb analysis (duplication of existing work)\n    35668104, # lipids superseded by others\n    33983923  # facial variation - 1k traits\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\na_keep <- subset(a, !pmid %in% pmid_ignore)\nwrite.table(a_keep$path, file=\"gwascat_keeplist.txt\", row=F, col=F, qu=F)\n```\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.0 (2023-04-21)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Monterey 12.6.8\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] ggplot2_3.4.2     ieugwasr_0.1.5    data.table_1.14.8 tidyr_1.3.0      \n[5] dplyr_1.1.2      \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.3      jsonlite_1.8.7    compiler_4.3.0    tidyselect_1.2.0 \n [5] scales_1.2.1      yaml_2.3.7        fastmap_1.1.1     R6_2.5.1         \n [9] labeling_0.4.2    generics_0.1.3    curl_5.0.2        knitr_1.43       \n[13] htmlwidgets_1.6.2 tibble_3.2.1      munsell_0.5.0     pillar_1.9.0     \n[17] rlang_1.1.1       utf8_1.2.3        xfun_0.39         cli_3.6.1        \n[21] withr_2.5.0       magrittr_2.0.3    digest_0.6.31     grid_4.3.0       \n[25] rstudioapi_0.14   lifecycle_1.0.3   vctrs_0.6.3       evaluate_0.21    \n[29] glue_1.6.2        farver_2.1.1      fansi_1.0.4       colorspace_2.1-0 \n[33] rmarkdown_2.22    purrr_1.0.2       httr_1.4.7        tools_4.3.0      \n[37] pkgconfig_2.0.3   htmltools_0.5.5  \n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}