{
  "hash": "14d594f9352e77795ff5082ff3b007cd",
  "result": {
    "markdown": "---\ntitle: \"Logistic regression residuals\"\nauthor: Gibran Hemani\ndate: \"2023-08-07\"\ncategories: []\n---\n\n\n## Background\n\nUsing REML to adjust for pedigree and then taking residuals to estimate PRS association. However the original trait is binary and the residuals are continuous, how to interpret the effect size?\n\n## Analysis\n\nSimulate data - a confounder influences x and y, x influences y, and y is binary.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nn <- 10000\nu <- rnorm(n)\nx <- rnorm(n) + u\na <- rnorm(n) + x + u - 1\ny <- rbinom(n, 1, plogis(a))\ntable(y)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ny\n   0    1 \n6331 3669 \n```\n:::\n:::\n\n\nEstimate using glm\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(glm(y ~ x + u, family=\"binomial\"))$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              Estimate Std. Error   z value      Pr(>|z|)\n(Intercept) -0.8456496 0.02749282 -30.75892 9.290785e-208\nx            0.7864091 0.02827687  27.81104 3.189961e-170\nu            0.8236558 0.03882063  21.21696 6.659380e-100\n```\n:::\n:::\n\n\nTransformation term\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmu <- sum(y) / length(y)\ntr <- mu * (1-mu)\n```\n:::\n\n\nGet residuals (raw)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyres_raw <- residuals(glm(y ~ u, family=\"binomial\"), type=\"response\")\nsummary(lm(yres_raw ~ x))$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                Estimate  Std. Error     t value     Pr(>|t|)\n(Intercept) 9.859144e-05 0.004038968  0.02441006 9.805260e-01\nx           6.044366e-02 0.002850011 21.20821889 1.114094e-97\n```\n:::\n:::\n\n\nAfter transformation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(yres_raw ~ x)$coef[2] / tr\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       x \n0.260214 \n```\n:::\n:::\n\n\nGet residuals (deviance)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyres_dev <- residuals(glm(y ~ u, family=\"binomial\"))\nsummary(lm(yres_dev ~ x))$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Estimate  Std. Error   t value      Pr(>|t|)\n(Intercept) -0.06563045 0.009654231 -6.798102  1.120585e-11\nx            0.20379274 0.006812301 29.915404 2.104826e-188\n```\n:::\n:::\n\n\nAfter transformation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(yres_dev ~ x)$coef[2] / tr\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        x \n0.8773415 \n```\n:::\n:::\n\n\n\nRange\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nparam <- expand.grid(\n    b=seq(-1, 1, by=0.1),\n    int=seq(-2,0, by=0.2)\n)\n\no <- lapply(1:nrow(param), \\(i) {\n    u <- rnorm(n)\n    x <- rnorm(n) + u\n    a <- rnorm(n) + x * param$b[i] + u + param$int[i]\n    y <- rbinom(n, 1, plogis(a))\n    mu <- sum(y) / length(y)\n    tr <- mu * (1-mu)\n    bhat <- glm(y ~ x + u, family=\"binomial\")$coef[2]\n    yres_raw <- residuals(glm(y ~ u, family=\"binomial\"), type=\"response\")\n    bhat_raw <- lm(yres_raw ~ x)$coef[2]\n    yres_dev <- residuals(glm(y ~ u, family=\"binomial\"))\n    bhat_dev <- lm(yres_dev ~ x)$coef[2]\n    tibble(bhat, bhat_raw, bhat_dev, bhat_raw_tr = bhat_raw / tr, bhat_dev_tr=bhat_dev / tr, tr=tr)\n}) %>% bind_rows() %>% bind_cols(param, .)\n```\n:::\n\n\nplot\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs(o %>% select(-c(int, tr)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndim(o)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 231   8\n```\n:::\n:::\n\n\nLooks like the deviance residuals are on the same scale after transformation, but will need a bit of work to translate between deviance and raw\n\nhttps://data.library.virginia.edu/understanding-deviance-residuals/\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.0 (2023-04-21)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Monterey 12.6.8\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] dplyr_1.1.2\n\nloaded via a namespace (and not attached):\n [1] digest_0.6.31     utf8_1.2.3        R6_2.5.1          fastmap_1.1.1    \n [5] tidyselect_1.2.0  xfun_0.39         magrittr_2.0.3    glue_1.6.2       \n [9] tibble_3.2.1      knitr_1.43        pkgconfig_2.0.3   htmltools_0.5.5  \n[13] generics_0.1.3    rmarkdown_2.22    lifecycle_1.0.3   cli_3.6.1        \n[17] fansi_1.0.4       vctrs_0.6.2       withr_2.5.0       compiler_4.3.0   \n[21] rstudioapi_0.14   tools_4.3.0       pillar_1.9.0      evaluate_0.21    \n[25] yaml_2.3.7        rlang_1.1.1       jsonlite_1.8.5    htmlwidgets_1.6.2\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}