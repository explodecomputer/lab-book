{
  "hash": "0b7e1ea2e28a8fd83120e66697288639",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Selection bias influencing family-based GWAS\"\nauthor: Gibran Hemani\ndate: \"2024-02-23\"\ncategories: []\n---\n\n\n## Background\n\nSelection bias where X influences inclusion in the data can distort genetic associations. Is this also true for family based genetic associations?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidyr)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# from https://github.com/MRCIEU/mrtwin_power/blob/master/scripts/sib_mr_functions.r\nmake_families <- function(af, nfam) {\n\tnsnp <- length(af)\n\tdads <- matrix(0, nfam, nsnp)\n\tmums <- matrix(0, nfam, nsnp)\n\tsibs1 <- matrix(0, nfam, nsnp)\n\tsibs2 <- matrix(0, nfam, nsnp)\n\tibd <- matrix(0, nfam, nsnp)\n\tibs <- matrix(0, nfam, nsnp)\n\tfor(i in 1:nsnp)\n\t{\n\t\tdad1 <- rbinom(nfam, 1, af[i]) + 1\n\t\tdad2 <- (rbinom(nfam, 1, af[i]) + 1) * -1\n\t\tmum1 <- rbinom(nfam, 1, af[i]) + 1\n\t\tmum2 <- (rbinom(nfam, 1, af[i]) + 1) * -1\n\n\t\tdadindex <- sample(c(TRUE, FALSE), nfam, replace=TRUE)\n\t\tdadh <- rep(NA, nfam)\n\t\tdadh[dadindex] <- dad1[dadindex]\n\t\tdadh[!dadindex] <- dad2[!dadindex]\n\n\t\tmumindex <- sample(c(TRUE, FALSE), nfam, replace=TRUE)\n\t\tmumh <- rep(NA, nfam)\n\t\tmumh[mumindex] <- mum1[mumindex]\n\t\tmumh[!mumindex] <- mum2[!mumindex]\n\n\t\tsib1 <- cbind(dadh, mumh)\n\n\t\tdadindex <- sample(c(TRUE, FALSE), nfam, replace=TRUE)\n\t\tdadh <- rep(NA, nfam)\n\t\tdadh[dadindex] <- dad1[dadindex]\n\t\tdadh[!dadindex] <- dad2[!dadindex]\n\n\t\tmumindex <- sample(c(TRUE, FALSE), nfam, replace=TRUE)\n\t\tmumh <- rep(NA, nfam)\n\t\tmumh[mumindex] <- mum1[mumindex]\n\t\tmumh[!mumindex] <- mum2[!mumindex]\n\n\t\tsib2 <- cbind(dadh, mumh)\n\n\t\tibd[,i] <- (as.numeric(sib1[,1] == sib2[,1]) + as.numeric(sib1[,2] == sib2[,2])) / 2\n\n\n\t\tsibs1[,i] <- rowSums(abs(sib1) - 1)\n\t\tsibs2[,i] <- rowSums(abs(sib2) - 1)\n\t\tdads[,i] <- dad1 - 1 + abs(dad2) - 1\n\t\tmums[,i] <- mum1 - 1 + abs(mum2) - 1\n\n\t\t# l[[i]] <- (sum(sib1[,1] == sib2[,1]) / nsnp + sum(sib1[,2] == sib2[,2]) / nsnp) / 2\n\n\t}\n\n\t# This may not be correct - getting some really large values\n\tibs <- scale(sibs1) * scale(sibs2)\n\n\t# Just count how many alleles are in common\n\tibs_unw <- abs(abs(sibs1 - sibs2) - 2) / 2\n\n    sibs1 <- as_tibble(sibs1)\n    sibs2 <- as_tibble(sibs2)\n    sdat <- bind_rows(\n        tibble(fid = 1:nfam, iid = paste0(1:nfam, \"a\"), sibs1),\n        tibble(fid = 1:nfam, iid = paste0(1:nfam, \"b\"), sibs2)\n    )\n    return(sdat)\n\n\treturn(list(dads=dads, mums=mums, sibs1=sibs1, sibs2=sibs2, ibd=ibd, ibs=ibs, ibs_unw=ibs_unw))\n\n}\n```\n:::\n\n\nDAG\n\n```\ng1 -> x\ng2 -> x\nx -> s\n```\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- make_families(c(0.4, 0.6), 100000)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `x` argument of `as_tibble.matrix()` must have unique column names if\n`.name_repair` is omitted as of tibble 2.0.0.\nℹ Using compatibility `.name_repair`.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat$x <- dat$V1 * 0.4 + dat$V2 * -0.4 + rnorm(nrow(dat))\ndat$s <- rbinom(nrow(dat), 1, plogis(dat$x))\ntable(dat$s)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     0      1 \n106442  93558 \n```\n\n\n:::\n:::\n\n\nEstimation in populations\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# No selection\nsummary(lm(x ~ V1, dat, subset=grepl(\"a\", dat$iid)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = x ~ V1, data = dat, subset = grepl(\"a\", dat$iid))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-4.4397 -0.7020 -0.0030  0.7069  4.7084 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -0.477390   0.005022  -95.07   <2e-16 ***\nV1           0.398992   0.004738   84.21   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.039 on 99998 degrees of freedom\nMultiple R-squared:  0.06622,\tAdjusted R-squared:  0.06621 \nF-statistic:  7091 on 1 and 99998 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# With selection\nsummary(lm(x ~ V1, dat, subset=grepl(\"a\", dat$iid) & dat$s))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = x ~ V1, data = dat, subset = grepl(\"a\", dat$iid) & \n    dat$s)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.7922 -0.6350 -0.0020  0.6344  4.2493 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 0.062212   0.006989   8.901   <2e-16 ***\nV1          0.318548   0.006195  51.417   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.9372 on 46899 degrees of freedom\nMultiple R-squared:  0.05336,\tAdjusted R-squared:  0.05334 \nF-statistic:  2644 on 1 and 46899 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\nEstimation in families\n\n\n::: {.cell}\n\n```{.r .cell-code}\na <- subset(dat, grepl(\"a\", dat$iid))\nb <- subset(dat, grepl(\"b\", dat$iid))\nab <- inner_join(a, b, by=\"fid\")\nab\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 100,000 × 11\n     fid iid.x  V1.x  V2.x      x.x   s.x iid.y  V1.y  V2.y     x.y   s.y\n   <int> <chr> <dbl> <dbl>    <dbl> <int> <chr> <dbl> <dbl>   <dbl> <int>\n 1     1 1a        2     2  0.974       1 1b        1     2 -0.220      1\n 2     2 2a        2     0  0.174       1 2b        1     1  0.211      0\n 3     3 3a        1     2  0.404       1 3b        1     1 -0.351      0\n 4     4 4a        0     2 -0.00896     0 4b        0     1  0.381      1\n 5     5 5a        1     2 -1.86        0 5b        0     2 -0.682      0\n 6     6 6a        1     2 -0.433       0 6b        0     2  0.161      1\n 7     7 7a        1     1 -0.189       0 7b        1     2  0.578      0\n 8     8 8a        1     2  0.0850      0 8b        2     2 -0.726      0\n 9     9 9a        2     2  1.25        0 9b        2     1  0.236      0\n10    10 10a       0     2 -0.479       0 10b       1     2 -0.0461     0\n# ℹ 99,990 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# No selection\nsummary(lm(I(x.x - x.y) ~ I(V1.x - V1.y), ab))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = I(x.x - x.y) ~ I(V1.x - V1.y), data = ab)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-6.3807 -0.9730  0.0080  0.9722  5.6960 \n\nCoefficients:\n               Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    0.005116   0.004559   1.122    0.262    \nI(V1.x - V1.y) 0.397261   0.006595  60.238   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.442 on 99998 degrees of freedom\nMultiple R-squared:  0.03502,\tAdjusted R-squared:  0.03501 \nF-statistic:  3629 on 1 and 99998 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# With selection\nsummary(lm(I(x.x - x.y) ~ I(V1.x - V1.y), ab, subset=ab$s.x==1 & ab$s.y==1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = I(x.x - x.y) ~ I(V1.x - V1.y), data = ab, subset = ab$s.x == \n    1 & ab$s.y == 1)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-5.2012 -0.8784  0.0009  0.8807  5.4372 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    2.302e-05  8.759e-03   0.003    0.998    \nI(V1.x - V1.y) 3.258e-01  1.257e-02  25.928   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.302 on 22087 degrees of freedom\nMultiple R-squared:  0.02954,\tAdjusted R-squared:  0.02949 \nF-statistic: 672.3 on 1 and 22087 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n## Summary\n\nThe selection bias is the same using within family and between family\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.3.2 (2023-10-31)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.6\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] tidyr_1.3.0 dplyr_1.1.4\n\nloaded via a namespace (and not attached):\n [1] digest_0.6.33     utf8_1.2.4        R6_2.5.1          fastmap_1.1.1    \n [5] tidyselect_1.2.0  xfun_0.41         magrittr_2.0.3    glue_1.6.2       \n [9] tibble_3.2.1      knitr_1.45        pkgconfig_2.0.3   htmltools_0.5.7  \n[13] rmarkdown_2.25    generics_0.1.3    lifecycle_1.0.4   cli_3.6.1        \n[17] fansi_1.0.5       vctrs_0.6.4       compiler_4.3.2    purrr_1.0.2      \n[21] tools_4.3.2       pillar_1.9.0      evaluate_0.23     yaml_2.3.7       \n[25] rlang_1.1.2       jsonlite_1.8.7    htmlwidgets_1.6.3\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}